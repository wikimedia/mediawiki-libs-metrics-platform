# Autogenerated by pipeline-to-gitlab
include:
  - project: 'repos/releng/kokkuri'
    file: 'includes/images.yaml'

variables:
  GIT_SUBMODULE_STRATEGY: recursive

stages:
  - test

.test-client:
  # Job template: all client library tests
  extends: .kokkuri:build-and-run-image
  stage: test
  variables:
    BUILD_VARIANT: test

test-java:
  # Run tests for Java client library
  extends: .test-client
  rules:
    - changes:
        - .mvn/**/*
        - .pipeline/blubber-java.yaml
        - java/**/*
        - mvnw
        - mvwn.cmnd
  variables:
    BUILD_CONFIG: .pipeline/blubber-java.yaml

test-js:
  # Run tests for Javascript client library
  extends: .test-client
  rules:
    - changes:
        - js/**/*
  variables:
    BUILD_CONTEXT: js

.test-client-php:
  # Job template: PHP client library tests
  extends: .test-client
  rules:
    - changes:
        - .phan/**/*
        - .pipeline/blubber-php.yaml
        - php/**/*
        - tests/consistency/*.php
        - tests/consistency/php/*
        - .phpcs.xml
        - composer.json
        - composer.lock
  variables:
    BUILD_CONFIG: .pipeline/blubber-php.yaml
    # Use the job name as the blubber build variant
    BUILD_VARIANT: "${CI_JOB_NAME}"

test-php81:
  # Run tests for PHP client library with PHP 8.1 runtime
  extends: .test-client-php

test-swift:
  extends: .test-client
  rules:
    - changes:
        - swift/**/*
  variables:
    BUILD_CONTEXT: swift
