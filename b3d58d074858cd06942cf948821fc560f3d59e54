{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "d8c6f991_00884a39",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 10
      },
      "lineNbr": 0,
      "author": {
        "id": 1196
      },
      "writtenOn": "2022-11-02T13:23:17Z",
      "side": 1,
      "message": "-1 for your attention only.\n\nSee inline for a couple comments about whitespace and two comments about the dispatch method and the formatting of the customData blob. I hope the comments are detailed enough but I\u0027m also happy to sync about this (and take notes on what I haven\u0027t provided enough detail about!).",
      "revId": "b3d58d074858cd06942cf948821fc560f3d59e54",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "60b1b438_be87c320",
        "filename": "java/src/main/java/org/wikimedia/metrics_platform/Event.java",
        "patchSetId": 10
      },
      "lineNbr": 46,
      "author": {
        "id": 1196
      },
      "writtenOn": "2022-11-02T13:23:17Z",
      "side": 1,
      "message": "Whitespace",
      "range": {
        "startLine": 46,
        "startChar": 0,
        "endLine": 46,
        "endChar": 1
      },
      "revId": "b3d58d074858cd06942cf948821fc560f3d59e54",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "29dbe3cd_3db4fc09",
        "filename": "java/src/main/java/org/wikimedia/metrics_platform/Event.java",
        "patchSetId": 10
      },
      "lineNbr": 46,
      "author": {
        "id": 9097
      },
      "writtenOn": "2022-11-10T06:30:46Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "60b1b438_be87c320",
      "range": {
        "startLine": 46,
        "startChar": 0,
        "endLine": 46,
        "endChar": 1
      },
      "revId": "b3d58d074858cd06942cf948821fc560f3d59e54",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "69c09a80_0603c601",
        "filename": "java/src/main/java/org/wikimedia/metrics_platform/MetricsClient.java",
        "patchSetId": 10
      },
      "lineNbr": 119,
      "author": {
        "id": 1196
      },
      "writtenOn": "2022-11-02T13:23:17Z",
      "side": 1,
      "message": "String eventName",
      "range": {
        "startLine": 119,
        "startChar": 25,
        "endLine": 119,
        "endChar": 36
      },
      "revId": "b3d58d074858cd06942cf948821fc560f3d59e54",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "cf15db25_f060da91",
        "filename": "java/src/main/java/org/wikimedia/metrics_platform/MetricsClient.java",
        "patchSetId": 10
      },
      "lineNbr": 119,
      "author": {
        "id": 2974
      },
      "writtenOn": "2022-11-02T13:34:09Z",
      "side": 1,
      "message": "This is mostly me being curious and not entirely understanding the intent. Feel free to ignore me:\n\nI\u0027m not sure I understand the intent of this dispatch() method. It seems to do something similar to the submit() method, and the following event processing that happens in sendEnqueuedEvents() and sendEventsToDestination(). In which case do we expect to use dispatch() over submit()? Is it just to support events with custom data? In that case, wouldn\u0027t it make sense to extend submit() to support this use case?\n\nHappy to have a more direct conversation about this (and also happy if you know where you are going and don\u0027t need me interfering!)",
      "range": {
        "startLine": 119,
        "startChar": 16,
        "endLine": 119,
        "endChar": 24
      },
      "revId": "b3d58d074858cd06942cf948821fc560f3d59e54",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "31957a9b_e31a6397",
        "filename": "java/src/main/java/org/wikimedia/metrics_platform/MetricsClient.java",
        "patchSetId": 10
      },
      "lineNbr": 119,
      "author": {
        "id": 9097
      },
      "writtenOn": "2022-11-10T06:30:46Z",
      "side": 1,
      "message": "i think the Event object is needed here to call the setter method?",
      "parentUuid": "69c09a80_0603c601",
      "range": {
        "startLine": 119,
        "startChar": 25,
        "endLine": 119,
        "endChar": 36
      },
      "revId": "b3d58d074858cd06942cf948821fc560f3d59e54",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "33e1a2a6_8f59c5b9",
        "filename": "java/src/main/java/org/wikimedia/metrics_platform/MetricsClient.java",
        "patchSetId": 10
      },
      "lineNbr": 119,
      "author": {
        "id": 9097
      },
      "writtenOn": "2022-11-10T06:30:46Z",
      "side": 1,
      "message": "good question - I will confer with Sam about whether it makes sense to extend submit() in lieu of creating dispatch()",
      "parentUuid": "cf15db25_f060da91",
      "range": {
        "startLine": 119,
        "startChar": 16,
        "endLine": 119,
        "endChar": 24
      },
      "revId": "b3d58d074858cd06942cf948821fc560f3d59e54",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d6e83e35_93ce676c",
        "filename": "java/src/main/java/org/wikimedia/metrics_platform/MetricsClient.java",
        "patchSetId": 10
      },
      "lineNbr": 119,
      "author": {
        "id": 9097
      },
      "writtenOn": "2022-11-13T21:26:43Z",
      "side": 1,
      "message": "Turns out we do want a separate these methods -- iirc submit() sends events via the modern event platform while dispatch() will send them via the metrics platform client.",
      "parentUuid": "33e1a2a6_8f59c5b9",
      "range": {
        "startLine": 119,
        "startChar": 16,
        "endLine": 119,
        "endChar": 24
      },
      "revId": "b3d58d074858cd06942cf948821fc560f3d59e54",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "dac3e38b_9c872407",
        "filename": "java/src/main/java/org/wikimedia/metrics_platform/MetricsClient.java",
        "patchSetId": 10
      },
      "lineNbr": 119,
      "author": {
        "id": 1196
      },
      "writtenOn": "2022-11-14T10:06:26Z",
      "side": 1,
      "message": "In the JS and PHP implementations, we construct the event internally rather than accepting the event from the client. This allows us to vary the representation of Metrics Platform Events (and how they are validated) transparently to the user (the instrumentation engineer).",
      "parentUuid": "31957a9b_e31a6397",
      "range": {
        "startLine": 119,
        "startChar": 25,
        "endLine": 119,
        "endChar": 36
      },
      "revId": "b3d58d074858cd06942cf948821fc560f3d59e54",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "770bbfee_733c9c36",
        "filename": "java/src/main/java/org/wikimedia/metrics_platform/MetricsClient.java",
        "patchSetId": 10
      },
      "lineNbr": 119,
      "author": {
        "id": 9097
      },
      "writtenOn": "2022-11-16T10:10:35Z",
      "side": 1,
      "message": "makes sense -- latest ps doesn\u0027t have this change yet -- may need to confer on how to get event from event name",
      "parentUuid": "dac3e38b_9c872407",
      "range": {
        "startLine": 119,
        "startChar": 25,
        "endLine": 119,
        "endChar": 36
      },
      "revId": "b3d58d074858cd06942cf948821fc560f3d59e54",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "2095c632_2793a3b5",
        "filename": "java/src/main/java/org/wikimedia/metrics_platform/MetricsClient.java",
        "patchSetId": 10
      },
      "lineNbr": 119,
      "author": {
        "id": 9097
      },
      "writtenOn": "2022-11-21T04:32:55Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "770bbfee_733c9c36",
      "range": {
        "startLine": 119,
        "startChar": 25,
        "endLine": 119,
        "endChar": 36
      },
      "revId": "b3d58d074858cd06942cf948821fc560f3d59e54",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0ae777ad_7422cdad",
        "filename": "java/src/main/java/org/wikimedia/metrics_platform/MetricsClient.java",
        "patchSetId": 10
      },
      "lineNbr": 119,
      "author": {
        "id": 9097
      },
      "writtenOn": "2022-11-21T04:32:55Z",
      "side": 1,
      "message": "per comment below from ps18, we want to keep submit() + dispatch() methods separate to keep MP decoupled from current event logging",
      "parentUuid": "d6e83e35_93ce676c",
      "range": {
        "startLine": 119,
        "startChar": 16,
        "endLine": 119,
        "endChar": 24
      },
      "revId": "b3d58d074858cd06942cf948821fc560f3d59e54",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "113446fd_2c58a761",
        "filename": "java/src/main/java/org/wikimedia/metrics_platform/MetricsClient.java",
        "patchSetId": 10
      },
      "lineNbr": 124,
      "author": {
        "id": 1196
      },
      "writtenOn": "2022-11-02T13:23:17Z",
      "side": 1,
      "message": "Here you\u0027ll need to find which streams that are interested in the event. A stream is said to be interested in an event if it contains the event name or a prefix of the event name in its producers.metrics_platform_client.events property. \n\nSee \nhttps://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/libs/metrics-platform/+/refs/heads/master/js/src/MetricsClient.js#62 and https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/libs/metrics-platform/+/refs/heads/master/php/src/StreamConfig/StreamConfigFactory.php#65 for the JS and PHP implementations, respectively.",
      "range": {
        "startLine": 124,
        "startChar": 8,
        "endLine": 124,
        "endChar": 81
      },
      "revId": "b3d58d074858cd06942cf948821fc560f3d59e54",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "621808bb_1acd9f64",
        "filename": "java/src/main/java/org/wikimedia/metrics_platform/MetricsClient.java",
        "patchSetId": 10
      },
      "lineNbr": 124,
      "author": {
        "id": 9097
      },
      "writtenOn": "2022-11-10T06:30:46Z",
      "side": 1,
      "message": "thanks - latest ps emulates js + php clients for checking streams for an event",
      "parentUuid": "113446fd_2c58a761",
      "range": {
        "startLine": 124,
        "startChar": 8,
        "endLine": 124,
        "endChar": 81
      },
      "revId": "b3d58d074858cd06942cf948821fc560f3d59e54",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "22581d81_9fa5595f",
        "filename": "java/src/main/java/org/wikimedia/metrics_platform/MetricsClient.java",
        "patchSetId": 10
      },
      "lineNbr": 124,
      "author": {
        "id": 1196
      },
      "writtenOn": "2022-11-14T10:06:26Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "621808bb_1acd9f64",
      "range": {
        "startLine": 124,
        "startChar": 8,
        "endLine": 124,
        "endChar": 81
      },
      "revId": "b3d58d074858cd06942cf948821fc560f3d59e54",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f777745e_c612c9a8",
        "filename": "java/src/main/java/org/wikimedia/metrics_platform/context/CustomData.java",
        "patchSetId": 10
      },
      "lineNbr": 20,
      "author": {
        "id": 1196
      },
      "writtenOn": "2022-11-02T13:23:17Z",
      "side": 1,
      "message": "Whitespace",
      "range": {
        "startLine": 20,
        "startChar": 0,
        "endLine": 20,
        "endChar": 2
      },
      "revId": "b3d58d074858cd06942cf948821fc560f3d59e54",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "fae1983b_ddde1798",
        "filename": "java/src/main/java/org/wikimedia/metrics_platform/context/CustomData.java",
        "patchSetId": 10
      },
      "lineNbr": 20,
      "author": {
        "id": 9097
      },
      "writtenOn": "2022-11-10T06:30:46Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "f777745e_c612c9a8",
      "range": {
        "startLine": 20,
        "startChar": 0,
        "endLine": 20,
        "endChar": 2
      },
      "revId": "b3d58d074858cd06942cf948821fc560f3d59e54",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c12260b1_0b3e13e8",
        "filename": "java/src/main/java/org/wikimedia/metrics_platform/context/CustomData.java",
        "patchSetId": 10
      },
      "lineNbr": 26,
      "author": {
        "id": 1196
      },
      "writtenOn": "2022-11-02T13:23:17Z",
      "side": 1,
      "message": "We should discuss whether the allowed values for data_type should be opened up/how to map Java.lang.Class.getSimpleName() to the allowed values.\n\nThe allowed values for data_type are specified here: https://gerrit.wikimedia.org/g/schemas/event/secondary/+/e3f3166162cbeca7d61e1ff7e9afee4f91cef49d/jsonschema/analytics/mediawiki/client/metrics_event/current.yaml#421\n\nSee also https://gerrit.wikimedia.org/g/mediawiki/libs/metrics-platform/+/627e245a12f29ddc6477058f447958eb4cab3608/js/src/MetricsClient.js#257",
      "range": {
        "startLine": 26,
        "startChar": 43,
        "endLine": 26,
        "endChar": 86
      },
      "revId": "b3d58d074858cd06942cf948821fc560f3d59e54",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c84f6fe1_c05f29ca",
        "filename": "java/src/main/java/org/wikimedia/metrics_platform/context/CustomData.java",
        "patchSetId": 10
      },
      "lineNbr": 26,
      "author": {
        "id": 9097
      },
      "writtenOn": "2022-11-10T06:30:46Z",
      "side": 1,
      "message": "got it -- limited to allowed enum values",
      "parentUuid": "c12260b1_0b3e13e8",
      "range": {
        "startLine": 26,
        "startChar": 43,
        "endLine": 26,
        "endChar": 86
      },
      "revId": "b3d58d074858cd06942cf948821fc560f3d59e54",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3275f8c3_7056cb38",
        "filename": "java/src/main/java/org/wikimedia/metrics_platform/context/CustomData.java",
        "patchSetId": 10
      },
      "lineNbr": 26,
      "author": {
        "id": 9097
      },
      "writtenOn": "2022-11-10T06:30:46Z",
      "side": 1,
      "message": "latest ps contains additional method for parsing data type",
      "parentUuid": "c12260b1_0b3e13e8",
      "range": {
        "startLine": 26,
        "startChar": 43,
        "endLine": 26,
        "endChar": 86
      },
      "revId": "b3d58d074858cd06942cf948821fc560f3d59e54",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e33cfc85_490cdeea",
        "filename": "java/src/main/java/org/wikimedia/metrics_platform/context/CustomData.java",
        "patchSetId": 10
      },
      "lineNbr": 26,
      "author": {
        "id": 1196
      },
      "writtenOn": "2022-11-14T10:06:26Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "c84f6fe1_c05f29ca",
      "range": {
        "startLine": 26,
        "startChar": 43,
        "endLine": 26,
        "endChar": 86
      },
      "revId": "b3d58d074858cd06942cf948821fc560f3d59e54",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9807019d_165c6f42",
        "filename": "java/src/main/java/org/wikimedia/metrics_platform/context/CustomData.java",
        "patchSetId": 10
      },
      "lineNbr": 29,
      "author": {
        "id": 1196
      },
      "writtenOn": "2022-11-02T13:23:17Z",
      "side": 1,
      "message": "AIUI this will result in a map with two entries, which correspond to the data type and value of the last member of the entry set of the keyValues map:\n\n {\n   data_type: \"…\"\n   value: \"…\"\n }\n\nRather, we want to create a map with an entry per entry set in the keyValues map:\n\n {\n   key: {\n     data_type: \"…\",\n     value: \"…\"\n   }\n }",
      "range": {
        "startLine": 24,
        "startChar": 0,
        "endLine": 29,
        "endChar": 39
      },
      "revId": "b3d58d074858cd06942cf948821fc560f3d59e54",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2a7b899f_c6f8700c",
        "filename": "java/src/main/java/org/wikimedia/metrics_platform/context/CustomData.java",
        "patchSetId": 10
      },
      "lineNbr": 29,
      "author": {
        "id": 9097
      },
      "writtenOn": "2022-11-10T06:30:46Z",
      "side": 1,
      "message": "aha - ok latest ps attempts to address this",
      "parentUuid": "9807019d_165c6f42",
      "range": {
        "startLine": 24,
        "startChar": 0,
        "endLine": 29,
        "endChar": 39
      },
      "revId": "b3d58d074858cd06942cf948821fc560f3d59e54",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b6b032d8_10e72ce3",
        "filename": "java/src/main/java/org/wikimedia/metrics_platform/context/CustomData.java",
        "patchSetId": 10
      },
      "lineNbr": 29,
      "author": {
        "id": 9097
      },
      "writtenOn": "2022-11-10T06:30:46Z",
      "side": 1,
      "message": "ah - hopefully latest ps addresses",
      "parentUuid": "9807019d_165c6f42",
      "range": {
        "startLine": 24,
        "startChar": 0,
        "endLine": 29,
        "endChar": 39
      },
      "revId": "b3d58d074858cd06942cf948821fc560f3d59e54",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a4345392_484c49e5",
        "filename": "java/src/main/java/org/wikimedia/metrics_platform/context/CustomData.java",
        "patchSetId": 10
      },
      "lineNbr": 29,
      "author": {
        "id": 1196
      },
      "writtenOn": "2022-11-14T10:06:26Z",
      "side": 1,
      "message": "I think the latest PS still has the same problem. Try writing a test for CustomData#formatCustomData() given input like\n\n  {\n    time_to_x: 1015\n  }\n\nyou get output like:\n\n  {\n    time_to_x: {\n      data_type: \"number\",\n      value: \"1015\"\n    }\n  }",
      "parentUuid": "b6b032d8_10e72ce3",
      "range": {
        "startLine": 24,
        "startChar": 0,
        "endLine": 29,
        "endChar": 39
      },
      "revId": "b3d58d074858cd06942cf948821fc560f3d59e54",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7a2f14dd_7816c93e",
        "filename": "java/src/main/java/org/wikimedia/metrics_platform/context/CustomData.java",
        "patchSetId": 10
      },
      "lineNbr": 29,
      "author": {
        "id": 9097
      },
      "writtenOn": "2022-11-16T10:10:35Z",
      "side": 1,
      "message": "one more time - i\u0027m still having issues with getting it to format correctly - hope to discuss in sync",
      "parentUuid": "a4345392_484c49e5",
      "range": {
        "startLine": 24,
        "startChar": 0,
        "endLine": 29,
        "endChar": 39
      },
      "revId": "b3d58d074858cd06942cf948821fc560f3d59e54",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "70755e31_1e8637ee",
        "filename": "java/src/main/java/org/wikimedia/metrics_platform/context/CustomData.java",
        "patchSetId": 10
      },
      "lineNbr": 29,
      "author": {
        "id": 9097
      },
      "writtenOn": "2022-11-21T04:34:00Z",
      "side": 1,
      "message": "hopefully this is finally correct",
      "parentUuid": "7a2f14dd_7816c93e",
      "range": {
        "startLine": 24,
        "startChar": 0,
        "endLine": 29,
        "endChar": 39
      },
      "revId": "b3d58d074858cd06942cf948821fc560f3d59e54",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951"
    }
  ]
}